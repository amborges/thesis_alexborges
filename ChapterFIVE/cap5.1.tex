\section{Complexidade das Estruturas de Particionamento}
\label{cap:5.1}

Para avaliar o custo computacional do processo de particionamento de blocos do formato AV1, realizou-se uma série de experimentos. Para a realização desses experimentos, foi utilizada a versão do \textit{libaom} disponível no momento inicial da pesquisa apresentada nesta tese (v1.0.0). Note-se que esta versão é diferente da utilizada nas etapas finais da pesquisa apresentada nesta tese, que é mais atualizada (como vimos na seção \ref{cap:4.2}). Apesar da versão 3.5.0 ser 61\% mais rápida que a versão 1.0.0 e apresentar um aumento de 4,07\% de BD-rate, conforme experimentos próprios realizados com cinco vídeos HD1080, as proporções gerais de complexidade observadas neste capítulo tendem a se manter.

O experimento realizado consiste em ativar e desativar ferramentas do \textit{libaom}, em uma estratégia conhecida como \textit{tool-on/off analysis}. Como o objetivo consiste em analisar as estruturas de particionamento, focamos em avaliar os parâmetros do \textit{libaom} que permitem a manipulação da árvore de particionamento. Assim, foi possível definir as 18 variações de parâmetros descritas na Tabela \ref{tab:VIII}. Podem ser observadas diversas variações, como ativar ou desativar os tipos \textit{RECT}, \textit{AB} e \textit{1TO4} (respectivamente, os parâmetros \texttt{enable-rect-partitions}, \texttt{enable-ab-partitions} e \texttt{enable-1to4-partitions}) ou realizar alterações diretas nas profundidades da árvore de particionamentos do AV1, através do tamanho de bloco quadrático máximo (\texttt{max-partition-size}) e mínimo (\texttt{min-partition-size}) permitidos. Neste último caso, existe uma restrição crítica: o valor mínimo do tamanho quadrático deve ser sempre menor que o valor máximo. Na Tabela \ref{tab:VIII}, também é apresentado o total de combinações de árvores que o AV1 poderá dispor para testes (considerando o algoritmo descrito no Apêndice \ref{apx:B}).

\input{TABLES/tab_viii.tex}

Foram realizados, portanto, 19 experimentos, os 18 experimentos descritos na Tabela \ref{tab:VIII}, além da codificação de referência (00) usada como base para as comparações. Todas essas codificações utilizam as mesmas configurações padrões do \textit{libaom} e utilizam quatro vídeos HD1080, conforme descrição detalhada realizada na seção \ref{cap:4.1}. Mesmo sem executar os experimentos, a Tabela \ref{tab:VIII} permite especular que a combinação 05 (testar apenas as profundidades 0 e 1) tende a ser a mais rápida, por possuir poucos arranjos de árvores para realização de testes preditivos (apenas 43). Em termos de redução de tempo de codificação, a combinação 05 deve ser seguida da combinação 09 (testar apenas as profundidades 1 e 2), pois esta possui 180 variações de árvores. No entanto, apesar de esses dois experimentos possuírem poucas possibilidades de árvores disponíveis para avaliação, as etapas de predições possuem custos de processamento diferentes, a depender do tamanho do bloco, o que influencia no tempo total de codificação. Por outro lado, os experimentos 04 e 12 tendem a apresentar resultados iguais, pois ambos possuem o mesmo número de árvores disponíveis para teste, inclusive com configurações praticamente idênticas. Na Tabela \ref{tab:VIII}, também constam os resultados obtidos com a execução dos experimentos, onde são mostrados valores de BD-rate e TS (vide equação 7).

Como mencionado anteriormente, esperava-se que as combinações 05 e 09 apresentassem os maiores valores de TS de todo o conjunto de experimentos. Todavia, isso não é o que se observa na Tabela \ref{tab:VIII}. As combinações com os maiores valores de TS foram as de número 18, 05 e 16, com a combinação 09 aparecendo apenas em quinto lugar. O maior destaque é para a combinação 18, com uma redução de complexidade de 76,66\%, o que se dá pela sua limitação: o codificador só tem à sua disposição blocos pequenos (8$\times$8 ou menores). Em termos gerais, processar os estágios de predição em blocos pequenos tende a ser computacionalmente menos custoso que em blocos maiores, como é possível observar com os dois extremos apresentados na Tabela \ref{tab:VIII}, onde vemos 43 árvores distintas na combinação 05 frente a 1792 da combinação 18. Outra parte da explicação para o valor de TS elevado da combinação 18, assim como na 16 (60,31\%), se deve ao percentual de representação dos diferentes tamanhos de bloco em um quadro, conforme discutido anteriormente no capítulo \ref{cap:2}. Naquele capítulo, a Tabela \ref{tab:I} evidenciou que um bloco 8$\times$8 representa uma área de 0.00309\% de um quadro de vídeo HD1080, enquanto blocos 4$\times$4 representam uma área ainda menor (0.00077\%). Logo, as perdas ocasionadas por predições imprecisas nesses casos é menor, tanto em termos de qualidade subjetiva, quanto em termos de qualidade objetiva da imagem. No entanto, há um agravante no uso exclusivo desses tamanhos de bloco: o elevado custo em taxa de bits para representação desses blocos no \textit{bitstream} codificado, justificando o BD-rate elevadíssimo observado no experimento 18.

Enquanto a combinação 18 emprega apenas blocos pequenos e isso impacta significativamente no BD-rate, a combinação 05, que utiliza exclusivamente blocos grandes, também apresenta problemas similares. Apesar de a quantidade de bits para representar a existência de blocos grandes ser significativamente menor, os resíduos da predição interquadros (especialmente) tendem a ser maiores, aumentando a complexidade das etapas seguintes à predição, como o cálculo de transformadas, quantização e codificação de entropia. Além disso, qualitativamente, a imagem resultante é menos agradável ao usuário, visto que sofre maiores perdas.

Na Tabela \ref{tab:VIII}, há outros resultados que merecem destaque, como as combinações que evitam particionamentos quaternários (combinação 03), ternários (02) e binários (01). Esta última combinação, inclusive, desabilita automaticamente as combinações 02 e 03. Os três experimentos apresentaram uma redução de tempo de 13,20\%, 12,88\% e 36,22\%, respectivamente. Como a combinação 01 também desabilita os particionamentos ternários e quaternários, é possível estimar que o particionamento binário possui um impacto aproximado de 10\% do tempo total de codificação do \textit{libaom} (ou seja, a subtração entre 36,22\% e os valores de 12,88\% e 13,20\%). Observa-se na Tabela \ref{tab:VIII} um baixo impacto na eficiência de codificação ao se desabilitar os particionamentos ternários (combinação 02) e quaternários (combinação 03) em vídeos HD1080, inferior a 0,4\% em BD-rate. No entanto, apesar dos particionamentos binários exigirem um tempo de codificação pouco abaixo dos particionamentos ternários e quaternários, o experimento com a combinação 01 indica que a ausência de predições retangulares impacta a codificação com um acréscimo de 4,81\% em BD-rate. Em outras palavras, é importante para a boa eficiência do codificador a disponibilidade dos modos de particionamento retangulares.

Outro ponto anteriormente levantado foi a semelhança entre os experimentos 04 e 12, que levam à mesma configuração no codificador. Apesar de ambos tecnicamente disporem do mesmo arranjo de árvores para codificação, essa igualdade não se replica nos resultados de BD-rate, respectivamente de 0,49\% e 0,48\%, e nem de TS, respectivamente de 15,49\% e 17,40\%. O principal fator que leva a essa diferença nos resultados está no fluxo de execução do próprio \textit{libaom}, que será apresentado na seção \ref{cap:7.4}. Enquanto no experimento 04 o \textit{libaom} parte de um superbloco de 64$\times$64 amostras, iniciando suas variáveis de controle a partir desse tamanho de bloco, a codificação com limitações na árvore (experimento 12) não impede que as variáveis do superbloco sejam iniciadas no bloco quadrático de tamanho 128$\times$128. Consequentemente, o \textit{libaom} dispõe de mais informações para melhor tomada de decisão no segundo caso, o que explica os melhores resultados do experimento 12 em relação ao experimento 04. 
